# 📑 右侧目录导航功能说明

## 🎯 功能概述

参考 Docusaurus 的页面布局，为博客文档页面添加了右侧固定目录导航，提供更好的文档浏览体验。

---

## ✨ 核心特性

### 1. **桌面端固定目录**
- 📌 右侧固定位置，跟随滚动
- 📊 自动高亮当前阅读的章节
- 🎨 Docusaurus 风格的视觉设计
- ⚡ 平滑滚动到目标位置
- 👁️ 滚动 100px 后淡入显示

### 2. **智能章节识别**
- 🔍 IntersectionObserver API 检测可见章节
- 🎯 自动高亮当前章节
- 📍 活动指示器显示当前位置
- 🔄 实时更新导航状态

### 3. **层级结构展示**
- 📑 H2、H3、H4 标题层级缩进
- 🎨 不同层级的视觉区分
- 📏 清晰的层级关系
- 🌳 树形结构展示

### 4. **移动端体验**
- 📱 移动端显示浮动按钮
- 🎈 点击展开目录菜单
- 📋 完整的目录列表
- ❌ 点击外部或选择后自动关闭

---

## 🎨 视觉设计

### Docusaurus 风格
```
┌────────────────────────────────┐
│  本页导航                       │
├────────────────────────────────┤
│  ● 章节 1                       │ <- 活动项（蓝色）
│    - 子章节 1.1                 │
│    - 子章节 1.2                 │
│  ○ 章节 2                       │ <- 普通项（灰色）
│    - 子章节 2.1                 │
│  ○ 章节 3                       │
├────────────────────────────────┤
│  ✏️ 编辑本页                    │
└────────────────────────────────┘
```

### 配色方案
- **活动状态**: 蓝色 (#2563eb) + 浅蓝背景
- **悬停状态**: 灰色背景 (#f9fafb)
- **默认状态**: 灰色文字 (#4b5563)
- **边框颜色**: 淡灰色 (#e5e7eb)

---

## 🔧 技术实现

### 1. IntersectionObserver 监听
```typescript
const observer = new IntersectionObserver(
  (entries) => {
    entries.forEach((entry) => {
      if (entry.isIntersecting) {
        setActiveId(entry.target.id);
      }
    });
  },
  { rootMargin: '-100px 0px -66% 0px' }
);
```

### 2. 平滑滚动
```typescript
onClick={(e) => {
  e.preventDefault();
  const element = document.getElementById(item.id);
  if (element) {
    const offset = 100;
    const elementPosition = element.getBoundingClientRect().top;
    const offsetPosition = elementPosition + window.pageYOffset - offset;
    window.scrollTo({
      top: offsetPosition,
      behavior: 'smooth'
    });
  }
}}
```

### 3. 响应式显示
```css
/* 桌面端（≥1280px）显示 */
.hidden xl:block w-72

/* 移动端显示浮动按钮 */
.xl:hidden fixed bottom-20 right-4
```

---

## 📱 响应式布局

### 桌面端（≥ 1280px）
- ✅ 右侧固定目录，宽度 288px (w-72)
- ✅ 粘性定位，跟随页面滚动
- ✅ 与主内容保持距离
- ✅ 边框分隔，视觉层次清晰

### 平板端（768px - 1279px）
- ✅ 隐藏右侧目录
- ✅ 显示浮动按钮
- ✅ 点击展开完整目录

### 移动端（< 768px）
- ✅ 浮动按钮在右下角
- ✅ 弹出式目录菜单
- ✅ 触摸友好的交互
- ✅ 选择后自动关闭

---

## 🎯 用户交互

### 桌面端操作
1. **查看目录**: 自动显示在右侧
2. **点击章节**: 平滑滚动到目标位置
3. **当前位置**: 自动高亮活动章节
4. **悬停效果**: 背景变色 + 左侧指示条

### 移动端操作
1. **打开目录**: 点击右下角浮动按钮
2. **选择章节**: 点击目录项跳转
3. **关闭目录**: 点击 X 或选择章节后自动关闭

---

## 🎨 UI 元素

### 1. 目录标题
```tsx
<h3>
  <svg>列表图标</svg>
  本页导航
</h3>
```
- 小型大写字母
- 加粗字体
- 图标点缀
- 底部边框分隔

### 2. 章节链接
- 圆角背景（hover/active）
- 左侧彩色边框指示
- 层级缩进展示
- 平滑过渡动画

### 3. 活动指示器
```tsx
{isActive && (
  <span className="absolute left-0 w-0.5 h-4 bg-primary-600" />
)}
```
- 竖线指示器
- 蓝色醒目
- 绝对定位
- 垂直居中

### 4. 编辑链接
- 图标 + 文字
- 灰色默认状态
- 悬停变蓝色
- 顶部边框分隔

---

## 🔄 动画效果

### 1. 淡入动画
```css
transition-opacity duration-300
opacity-0 → opacity-100 (滚动后)
```

### 2. 滑动动画
```css
@keyframes slideUp {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}
```

### 3. 悬停效果
- 背景色过渡
- 左侧指示条展开
- 文字颜色变化
- 200ms 平滑过渡

---

## 📊 性能优化

### 1. IntersectionObserver
- ✅ 原生 API，性能优秀
- ✅ 自动管理监听/取消监听
- ✅ 支持阈值配置
- ✅ 兼容性好

### 2. CSS 过渡
- ✅ GPU 加速
- ✅ transform 代替 position
- ✅ will-change 优化
- ✅ 避免重排重绘

### 3. 事件优化
- ✅ passive scroll listener
- ✅ 防抖处理
- ✅ 事件委托
- ✅ 及时清理监听器

---

## 🎓 代码结构

### 组件文件
```
src/components/TableOfContents.tsx
├── 桌面端固定目录
│   ├── 标题区域
│   ├── 导航列表
│   └── 编辑链接
└── 移动端浮动按钮
    ├── 触发按钮
    └── 弹出菜单
```

### 样式文件
```
src/app/globals.css
├── .toc-nav - 目录导航样式
├── 悬停效果
├── 活动项动画
└── 移动端菜单动画
```

---

## 🌟 最佳实践

### 1. 可访问性
- ✅ 语义化 HTML（nav, ul, li）
- ✅ ARIA 标签
- ✅ 键盘导航支持
- ✅ 屏幕阅读器友好

### 2. SEO 优化
- ✅ 锚点链接优化
- ✅ 标题层级正确
- ✅ 内容结构清晰
- ✅ 导航辅助索引

### 3. 用户体验
- ✅ 视觉反馈及时
- ✅ 交互流畅自然
- ✅ 状态清晰明确
- ✅ 错误处理完善

---

## 🚀 使用方法

### 立即体验
1. **访问文档页面**: http://localhost:3001/docs/[任意文档]
2. **查看右侧目录**: 桌面端自动显示
3. **点击章节标题**: 平滑滚动到目标
4. **观察高亮**: 当前章节自动标记

### 移动端测试
1. **调整浏览器宽度** < 1280px
2. **查看右下角** 浮动按钮
3. **点击按钮** 展开目录
4. **选择章节** 自动跳转并关闭

---

## 🎨 自定义配置

### 修改宽度
```tsx
// TableOfContents.tsx
className="w-72" // 改为 w-64 或 w-80
```

### 调整滚动偏移
```typescript
const offset = 100; // 改为你需要的偏移值
```

### 修改高亮颜色
```tsx
// 活动状态
className="text-primary-600 bg-primary-50"
// 改为你的品牌色
```

### 调整层级缩进
```typescript
paddingLeft: `${(item.level - 2) * 16}px`
// 改为 12px 或 20px
```

---

## 📈 对比改进

### 优化前
- ❌ 目录不明显
- ❌ 无当前位置指示
- ❌ 移动端无目录
- ❌ 缺少视觉层次

### 优化后
- ✅ 右侧固定目录
- ✅ 自动高亮当前章节
- ✅ 移动端浮动按钮
- ✅ Docusaurus 风格设计
- ✅ 完整的交互反馈

---

## 🎉 总结

### 核心价值
- 📖 **提升阅读体验** - 清晰的导航结构
- 🎯 **快速定位** - 一键跳转到目标章节
- 📱 **全设备支持** - 桌面端和移动端完美适配
- 🎨 **专业外观** - Docusaurus 风格的精美设计

### 技术亮点
- ⚡ **性能优秀** - IntersectionObserver + CSS 动画
- 🎯 **交互流畅** - 平滑滚动 + 即时反馈
- 📐 **响应式** - 完美适配各种屏幕尺寸
- 🔧 **易维护** - 清晰的代码结构

立即刷新页面，体验 Docusaurus 风格的右侧目录导航！🚀
